# GitHub Actions Workflows

This repository includes several GitHub Actions workflows for automated building, versioning, and releasing of the AniSurge Android app.

## Workflows Overview

### 1. üöÄ Release Workflow (`.github/workflows/release.yml`)

**Triggers:**
- Push to version tags (e.g., `v2.26.5`)
- Manual dispatch with custom version

**What it does:**
- Extracts version from tag or manual input
- Updates all version numbers across the project
- Builds React Native bundle
- Compiles Android APKs for all architectures
- Creates GitHub release with APK files
- Optionally uploads to public repository

**APK Files Generated:**
- `AniSurge-v{version}-universal.apk` - Universal compatibility
- `AniSurge-v{version}-arm64-v8a.apk` - 64-bit ARM devices
- `AniSurge-v{version}-x86_64.apk` - 64-bit Intel/AMD devices
- `AniSurge-v{version}-x86.apk` - 32-bit Intel/AMD devices

### 2. üè∑Ô∏è Auto Version Workflow (`.github/workflows/auto-version.yml`)

**Triggers:**
- Push to main/master branches
- Manual dispatch

**What it does:**
- Detects version bump keywords in commit messages
- Automatically increments version numbers
- Creates and pushes version tags
- Triggers the release workflow

**Keywords that trigger version bumps:**
- `major` - Increments major version (1.0.0 ‚Üí 2.0.0)
- `minor` - Increments minor version (1.0.0 ‚Üí 1.1.0)
- `patch` - Increments patch version (1.0.0 ‚Üí 1.0.1)
- `bump`, `version`, `release` - Defaults to patch bump

### 3. üîß Development Build Workflow (`.github/workflows/build-dev.yml`)

**Triggers:**
- Push to develop/dev/feature/hotfix branches
- Pull requests
- Manual dispatch

**What it does:**
- Builds development APKs
- Uploads as artifacts (retained for 7 days)
- Comments on PRs with download instructions
- Does NOT create releases

## Usage Instructions

### Creating a Release

#### Method 1: Automatic (Recommended)
1. Make your changes and commit with a version bump message:
   ```bash
   git commit -m "feat: add new feature (minor version bump)"
   git push origin main
   ```
2. The auto-version workflow will detect the bump and create a tag
3. The release workflow will automatically build and create a release

#### Method 2: Manual Tag
1. Update version manually:
   ```bash
   node scripts/version-manager.js update 2.26.5 1
   git add .
   git commit -m "chore: bump version to 2.26.5"
   git push origin main
   ```
2. Create and push a tag:
   ```bash
   git tag -a v2.26.5 -m "Release v2.26.5"
   git push origin v2.26.5
   ```
3. The release workflow will automatically trigger

#### Method 3: Manual Dispatch
1. Go to Actions tab in GitHub
2. Select "Build and Release APKs" workflow
3. Click "Run workflow"
4. Enter version and version code
5. Click "Run workflow"

### Development Builds

Development builds are automatically created for:
- Feature branches
- Hotfix branches
- Pull requests

APKs are uploaded as artifacts and can be downloaded from the Actions tab.

## Configuration

### Required Secrets

- `GITHUB_TOKEN` - Automatically provided by GitHub
- `PUBLIC_REPO_TOKEN` (optional) - For uploading to public repository

### Version Management

The project uses a centralized version management system:

- **package.json** - NPM package version
- **app.json** - Expo app version and Android version code
- **constants/appConfig.ts** - App configuration version
- **android/app/build.gradle** - Android build version (generated by prebuild)

All versions are kept in sync using the `scripts/version-manager.js` script.

## File Structure

```
.github/
‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îú‚îÄ‚îÄ release.yml          # Main release workflow
‚îÇ   ‚îú‚îÄ‚îÄ auto-version.yml     # Automatic versioning
‚îÇ   ‚îú‚îÄ‚îÄ build-dev.yml        # Development builds
‚îÇ   ‚îî‚îÄ‚îÄ README.md           # This file
‚îî‚îÄ‚îÄ README.md               # This file
```

## Troubleshooting

### Common Issues

1. **Version mismatch errors**
   - Run `node scripts/version-manager.js check` to identify inconsistencies
   - Run `node scripts/version-manager.js update <version> <code>` to fix

2. **Build failures**
   - Check that all dependencies are properly installed
   - Ensure Android SDK is properly configured
   - Verify that the React Native bundle step completes successfully

3. **Release not created**
   - Ensure the tag follows the format `v*.*.*` (e.g., `v2.26.5`)
   - Check that the workflow has the necessary permissions
   - Verify that the GITHUB_TOKEN has release permissions

### Manual Commands

```bash
# Check current versions
node scripts/version-manager.js check

# Update to specific version
node scripts/version-manager.js update 2.26.5 1

# Increment patch version
node scripts/version-manager.js patch

# Increment minor version
node scripts/version-manager.js minor

# Increment major version
node scripts/version-manager.js major

# Run prebuild after version update
node scripts/version-manager.js update 2.26.5 1 --prebuild
```

## Best Practices

1. **Always use semantic versioning** (MAJOR.MINOR.PATCH)
2. **Include version bump keywords** in commit messages for automatic versioning
3. **Test development builds** before creating releases
4. **Keep version numbers consistent** across all configuration files
5. **Use meaningful commit messages** for better release notes

## Support

For issues with the GitHub Actions workflows, check:
1. The Actions tab for workflow logs
2. This README for troubleshooting steps
3. The version management script documentation
