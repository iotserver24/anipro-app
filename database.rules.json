{
  "rules": {
    "public_chat": {
      ".read": "auth != null",
      ".write": "auth != null || root.child('public_chat').child(newData.child('userId').val()).exists() || newData.child('userId').val().endsWith('-ai')",
      ".indexOn": ["timestamp", "negativeTimestamp"],
      "$message_id": {
        ".validate": "newData.hasChildren(['userId', 'userName', 'content', 'timestamp', 'negativeTimestamp'])",
        "userId": {
          ".validate": "newData.isString()"
        },
        "userName": {
          ".validate": "newData.isString()"
        },
        "content": {
          ".validate": "newData.isString() && (newData.parent().child('userId').val().endsWith('-ai') || newData.val().length <= 1000)"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        },
        "negativeTimestamp": {
          ".validate": "newData.isNumber() && newData.val() === -newData.parent().child('timestamp').val()"
        },
        "$other": {
          ".validate": true
        }
      }
    },
    "$other": {
      ".read": false,
      ".write": false
    }
  }
}